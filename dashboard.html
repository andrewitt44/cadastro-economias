<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de Economias</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1>Sistema de Economias</h1>
                <div class="user-info">
                    <div class="user-profile" id="userProfile">
                        <div class="user-avatar-placeholder" id="userAvatar">?</div>
                        <div class="user-details">
                            <span class="user-name" id="userName">Carregando...</span>
                            <span class="user-email" id="userEmail"></span>
                        </div>
                    </div>
                    <button id="logoutBtn" class="btn-logout">Sair</button>
                    <button id="deleteAccountBtn" class="btn-logout" style="background: var(--danger); color: white; font-size: 11px; padding: 4px 8px; margin-left: 4px;" title="Excluir conta (para testes)">üóëÔ∏è</button>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="app-main">
            <!-- Indicators -->
            <section class="indicators">
                <div class="indicator-card">
                    <h3>Total Economizado</h3>
                    <p class="indicator-value" id="totalEconomizado">R$ 0,00</p>
                </div>
                <div class="indicator-card success">
                    <h3>Total Aprovado</h3>
                    <p class="indicator-value" id="totalAprovado">R$ 0,00</p>
                </div>
                <div class="indicator-card warning">
                    <h3>Total Pendente</h3>
                    <p class="indicator-value" id="totalPendente">R$ 0,00</p>
                </div>
            </section>
            
            <!-- Actions -->
            <section class="actions-bar">
                <button id="btnNovaEconomia" class="btn btn-primary">+ Nova Economia</button>
                
                <!-- Filtros (vis√≠vel para todos) -->
                <div id="filtros" class="filters">
                    <!-- Filtro de usu√°rio (apenas para Gestor) -->
                    <select id="filtroUsuario" class="filter-select" style="display: none;">
                        <option value="">Todos os usu√°rios</option>
                    </select>
                    
                    <select id="filtroTipo" class="filter-select">
                        <option value="">Todos os tipos</option>
                        <option value="BID">BID</option>
                        <option value="Cota√ß√£o">Cota√ß√£o</option>
                    </select>
                    
                    <select id="filtroStatus" class="filter-select">
                        <option value="">Todos os status</option>
                        <option value="Aprovado">Aprovado</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Reprovado">Reprovado</option>
                    </select>
                    
                    <input type="date" id="filtroDataInicio" class="filter-input" placeholder="Data In√≠cio">
                    <input type="date" id="filtroDataFim" class="filter-input" placeholder="Data Fim">
                    
                    <button id="btnAplicarFiltros" class="btn btn-secondary">Aplicar Filtros</button>
                    <button id="btnLimparFiltros" class="btn btn-secondary">Limpar</button>
                </div>
            </section>
            
            <!-- Tabela de Economias -->
            <section class="economias-list">
                <div class="table-header">
                    <h2>Economias Cadastradas</h2>
                    <div class="table-info">
                        <span id="tableInfo">Registros 1-25 de 858</span>
                    </div>
                </div>
                <div class="table-container">
                    <table id="tabelaEconomias" class="economias-table">
                        <thead>
                            <tr>
                                <th>Opera√ß√£o</th>
                                <th>Modal</th>
                                <th>Fornecedor</th>
                                <th>Auditor</th>
                                <th>Valor</th>
                                <th>Moeda</th>
                                <th>Data</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="listaEconomias">
                            <!-- Economias ser√£o renderizadas aqui -->
                        </tbody>
                    </table>
                </div>
                <div class="table-pagination">
                    <button class="btn btn-secondary btn-small" id="btnFirstPage">‚Äπ‚Äπ</button>
                    <button class="btn btn-secondary btn-small" id="btnPrevPage">‚Äπ</button>
                    <span class="pagination-info">P√°gina <span id="currentPage">1</span> de <span id="totalPages">1</span></span>
                    <button class="btn btn-secondary btn-small" id="btnNextPage">‚Ä∫</button>
                    <button class="btn btn-secondary btn-small" id="btnLastPage">‚Ä∫‚Ä∫</button>
                </div>
            </section>
        </main>
    </div>
    
    <!-- Modal de Sele√ß√£o de Tipo -->
    <div id="modalTipoEconomia" class="modal" style="display: none;">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Selecione o Tipo de Economia</h2>
                <button class="modal-close" id="closeModalTipo">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tipo-selection">
                    <button class="tipo-card" id="btnCancelamento">
                        <div class="tipo-icon">üö´</div>
                        <h3>Cancelamento</h3>
                        <p>Registro de valores cancelados</p>
                    </button>
                    <button class="tipo-card" id="btnCorrecao">
                        <div class="tipo-icon">‚úèÔ∏è</div>
                        <h3>Corre√ß√£o</h3>
                        <p>Corre√ß√£o de valores originais</p>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cancelamento -->
    <div id="modalCancelamento" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nova Economia - Cancelamento</h2>
                <button class="modal-close" id="closeCancelamento">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formCancelamento">
                    <div class="form-group">
                        <label for="canc_codigoFornecedor">C√≥digo do Fornecedor *</label>
                        <input type="text" id="canc_codigoFornecedor" name="codigoFornecedor" 
                               placeholder="Ex: FORN-001" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="canc_data">Data *</label>
                        <input type="date" id="canc_data" name="data" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="canc_moeda">Moeda *</label>
                        <select id="canc_moeda" name="moeda" required>
                            <option value="BRL">BRL</option>
                            <option value="USD">USD</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="canc_agioGroup" style="display: none;">
                        <label for="canc_agio">√Ågio (%)</label>
                        <input type="number" id="canc_agio" name="agio" 
                               step="0.01" min="0" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="canc_valorCancelado"><span id="canc_moedaLabel">Valor Cancelado (BRL)</span> *</label>
                        <input type="number" id="canc_valorCancelado" name="valorCancelado" 
                               step="0.01" min="0" required>
                    </div>
                    
                    <div class="form-group" id="canc_ptaxGroup" style="display: none;">
                        <label for="canc_ptax">PTAX (USD)</label>
                        <input type="number" id="canc_ptax" name="ptax" 
                               step="0.0001" readonly>
                    </div>
                    
                    <div class="form-group" id="canc_valorBRLGroup" style="display: none;">
                        <label for="canc_valorBRL">Valor em BRL</label>
                        <input type="number" id="canc_valorBRL" name="valorBRL" 
                               step="0.01" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="canc_tipo">Tipo *</label>
                        <select id="canc_tipo" name="tipo" required>
                            <option value="">Selecione...</option>
                            <option value="BID">BID</option>
                            <option value="Cota√ß√£o">Cota√ß√£o</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="canc_descricao">Descri√ß√£o</label>
                        <textarea id="canc_descricao" name="descricao" rows="3" 
                                  placeholder="Descreva o motivo do cancelamento..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="canc_arquivo">Arquivos de Prova (PDF, PNG, JPG) *</label>
                        <input type="file" id="canc_arquivo" name="arquivo" 
                               accept=".pdf,.png,.jpg,.jpeg" multiple required>
                        <small class="form-help">Tamanho m√°ximo: 5MB por arquivo.</small>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancelCancelamento">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Corre√ß√£o -->
    <div id="modalCorrecao" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nova Economia - Corre√ß√£o</h2>
                <button class="modal-close" id="closeCorrecao">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formCorrecao">
                    <div class="form-group">
                        <label for="corr_codigoFornecedor">C√≥digo do Fornecedor *</label>
                        <input type="text" id="corr_codigoFornecedor" name="codigoFornecedor" 
                               placeholder="Ex: FORN-001" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="corr_data">Data *</label>
                        <input type="date" id="corr_data" name="data" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="corr_moeda">Moeda *</label>
                        <select id="corr_moeda" name="moeda" required>
                            <option value="BRL">BRL</option>
                            <option value="USD">USD</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="corr_agioGroup" style="display: none;">
                        <label for="corr_agio">√Ågio (%)</label>
                        <input type="number" id="corr_agio" name="agio" 
                               step="0.01" min="0" value="0">
                    </div>
                    
                    <div class="form-group" id="corr_ptaxGroup" style="display: none;">
                        <label for="corr_ptax">PTAX (USD)</label>
                        <input type="number" id="corr_ptax" name="ptax" 
                               step="0.0001" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="corr_valorOriginal"><span id="corr_moedaLabelOriginal">Valor Original (BRL)</span> *</label>
                        <input type="number" id="corr_valorOriginal" name="valorOriginal" 
                               step="0.01" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="corr_useDesconto" name="useDesconto">
                            Desconto
                        </label>
                    </div>
                    
                    <div class="form-group" id="corr_descontoGroup" style="display: none;">
                        <label for="corr_desconto">Desconto (%)</label>
                        <input type="number" id="corr_desconto" name="desconto" 
                               step="0.01" min="0" max="100" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="corr_valorCorrigido"><span id="corr_moedaLabelCorrigido">Valor Corrigido (BRL)</span> *</label>
                        <input type="number" id="corr_valorCorrigido" name="valorCorrigido" 
                               step="0.01" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="corr_valorEconomia"><span id="corr_moedaLabelEconomia">Valor da Economia (BRL)</span></label>
                        <input type="number" id="corr_valorEconomia" name="valorEconomia" 
                               step="0.01" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="corr_tipo">Tipo *</label>
                        <select id="corr_tipo" name="tipo" required>
                            <option value="">Selecione...</option>
                            <option value="BID">BID</option>
                            <option value="Cota√ß√£o">Cota√ß√£o</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="corr_descricao">Descri√ß√£o</label>
                        <textarea id="corr_descricao" name="descricao" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="corr_arquivo">Arquivos de Prova (PDF, PNG, JPG) *</label>
                        <input type="file" id="corr_arquivo" name="arquivo" 
                               accept=".pdf,.png,.jpg,.jpeg" multiple required>
                        <small class="form-help">Tamanho m√°ximo: 5MB por arquivo.</small>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancelCorrecao">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal de Aprova√ß√£o (Gestor) -->
    <div id="modalAprovacao" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Aprovar/Reprovar Economia</h2>
                <button class="modal-close" id="closeModalAprovacao">&times;</button>
            </div>
            <div class="modal-body">
                <div id="detalhesEconomia"></div>
                <form id="formAprovacao">
                    <div class="form-group">
                        <label for="observacoes">Observa√ß√µes</label>
                        <textarea id="observacoes" name="observacoes" rows="3"></textarea>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" id="cancelAprovacao">Cancelar</button>
                        <button type="button" class="btn btn-danger" id="btnReprovar">Reprovar</button>
                        <button type="button" class="btn btn-success" id="btnAprovar">Aprovar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Supabase SDK -->
    <script src="js/supabase.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/model.js"></script>
    <script src="js/view.js"></script>
    <script src="js/controller.js"></script>
    <script>
        // Inicializar dashboard com autentica√ß√£o Supabase (async)
        Controller.initDashboard();
    </script>
</body>
</html>
